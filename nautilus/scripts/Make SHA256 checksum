#!/usr/bin/env nu

# SPDX-FileCopyrightText: 2025 Gabriel Arazas <foodogsquared@foodogsquared.one>
#
# SPDX-License-Identifier: GPL-3.0-or-later

def main [...rest: string] {
    let files = $env.NAUTILUS_SCRIPT_SELECTED_FILE_PATHS? | default $rest | split row "\n" | filter { |x| $x | str trim | is-not-empty}
    $files | par-each { |f|
        if (echo $f | path type) == dir { glob --no-dir --no-symlink $"($f)/**/*" } else { $f }
    } | flatten
    | par-each {|f| { name: ($f | path relative-to ($env.PWD)), hash: (open --raw $f | hash sha256) } }
    | sort-by name
    | each { |fo| $"($fo.hash) ($fo.name)" }
    | save --force "sha256checksum.txt"
}
